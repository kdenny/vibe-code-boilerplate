#!/usr/bin/env bash
#
# Secrets - Secret management CLI
#
# Commands:
#   secrets list              - List secrets from providers
#   secrets sync <file>       - Sync secrets to a provider
#   secrets allowlist list    - List allowlist entries
#   secrets allowlist add     - Add allowlist entry
#

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(dirname "$SCRIPT_DIR")"

VENV_DIR="$REPO_ROOT/.vibe/.venv"

# Ensure venv exists (run vibe once to set it up)
if [[ ! -d "$VENV_DIR" ]]; then
    echo "Virtual environment not found. Running setup..."
    "$SCRIPT_DIR/vibe" doctor > /dev/null 2>&1 || true
fi

# Activate venv and run
source "$VENV_DIR/bin/activate"
cd "$REPO_ROOT"
python -m lib.vibe.cli.secrets "$@"
